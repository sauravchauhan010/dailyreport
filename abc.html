<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Daily Activity Manager</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #6366f1;
            --purple-color: #8b5cf6;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom scrollbar for better aesthetics */
        .task-list-container::-webkit-scrollbar {
            width: 8px;
        }
        .task-list-container::-webkit-scrollbar-thumb {
            background-color: var(--secondary-color);
            border-radius: 10px;
        }
        .task-list-container::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
        /* Style for the date input to look better */
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(1);
        }

        /* --- PRINT STYLES FOR CLEAN PDF EXPORT --- */
        @media print {
            /* Hide the main application UI */
            body > *:not(#report-modal) {
                display: none !important;
            }
            /* Make the modal take the entire page and hide its background/shadows */
            #report-modal {
                position: static; 
                width: 100%;
                height: auto;
                background: none;
                display: block !important;
                opacity: 1 !important;
                padding: 0;
            }
            /* Hide the action buttons and close button */
            .print-hide {
                display: none !important;
            }


            /* CRITICAL FIX: Remove max height and scroll for printing */
            #report-content {
                max-height: none !important; 
                overflow-y: visible !important;
            }


            /* Ensure the content container is clean */
            #report-modal > div {
                max-width: none;
                margin: 0;
                padding: 30px; /* Add some padding for paper */
                box-shadow: none;
                border-radius: 0;
                background-color: white !important;
            }
            /* Ensure text is black for printing and remove background colors */
            .report-section, .report-header, .report-item {
                box-shadow: none !important;
                border-color: #eee !important;
            }
            * {
                color: #000 !important;
                background-color: transparent !important;
            }
        }
    </style>
    
    <script>
        // --- GLOBAL STATE & LOCAL STORAGE LOGIC ---
        
        const STORAGE_KEY = 'localDailyReports';
        const AUTH_KEY = 'sessionActive'; // Key used by index.html for checking login
        let allReports = {}; 
        let selectedDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD

        // Variables to store the generated report for sharing (clean text only)
        let currentReportText = "";
        let currentReportSubject = "";

        const APP_NAME = "Daily Activity Manager";
        const USER_NAME = "SAURAV CHAUHAN";

        const taskSources = ["Outlook", "WhatsApp", "CDesk", "CRM", "Google Meeting", "R-points", "Phone Call", "Internal Project","Teams", "Authorization","Other"];

        /**
         * Loads all reports from localStorage into the global allReports object.
         */
        function loadReportsFromStorage() {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                allReports = storedData ? JSON.parse(storedData) : {};
            } catch (error) {
                console.error("Error loading reports from localStorage:", error);
                allReports = {};
            }
        }

        /**
         * Saves the current global allReports object to localStorage.
         */
        function saveReportsToStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(allReports));
            } catch (error) {
                console.error("Error saving reports to localStorage:", error);
                alertUser("Warning: Could not save data to browser storage.");
            }
        }

        /**
         * Function to handle user logout.
         * Clears the specific auth key and redirects to index.html with a logout flag.
         */
        function handleLogout() {
            // 1. Clear ONLY the specific session key, leaving reports intact if user logs back in
            localStorage.removeItem(AUTH_KEY); 
            
            // 2. Redirect to the index/login page with the critical flag.
            // The flag (?logout=true) tells index.html to skip the auto-redirect.
            window.location.href = "index.html?logout=true";
        }


        /**
         * Initializes the application by loading storage and setting up UI.
         */
        function initializeApp() {
            loadReportsFromStorage();
            setupEventListeners();
            
            // Hide loading, show app
            document.getElementById('loading-message').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');

            refreshTaskList(); // Initial load
        }

        /**
         * Retrieves the tasks for the selected date from the local map.
         * @param {string} date - The date in YYYY-MM-DD format.
         * @returns {Array<Object>} The array of tasks for that date.
         */
        function getTasksForDate(date) {
            return allReports[date] || [];
        }

        /**
         * Applies filtering based on user input (Source and Search Text).
         * @param {Array<Object>} tasks - The raw list of tasks for the selected date.
         * @returns {Array<Object>} The filtered list of tasks.
         */
        function applyFilters(tasks) {
            const filterSource = document.getElementById('filter-source').value;
            const searchText = document.getElementById('search-text').value.toLowerCase().trim();
            
            let filtered = tasks;

            // 1. Filter by Source
            if (filterSource) {
                filtered = filtered.filter(task => task.source === filterSource);
            }

            // 2. Filter by Search Text (in description)
            if (searchText) {
                filtered = filtered.filter(task => 
                    task.description.toLowerCase().includes(searchText)
                );
            }

            return filtered;
        }

        /**
         * Retrieves the tasks for the selected date, applies filters, and triggers rendering.
         * This is the main function to call whenever tasks or filters change.
         */
        function refreshTaskList() {
            const taskListElement = document.getElementById('task-list');
            const summaryElement = document.getElementById('summary-display');
            taskListElement.innerHTML = '';
            summaryElement.textContent = 'Processing...';

            const tasksForDate = getTasksForDate(selectedDate); // Get raw tasks for the date
            
            const filteredTasks = applyFilters(tasksForDate); // Apply filters

            renderTasks(filteredTasks, taskListElement, summaryElement);
        }

        /**
         * Renders the tasks and updates the summary display.
         * @param {Array<Object>} tasks - Array of task objects (already filtered).
         * @param {HTMLElement} listEl - The DOM element to render the list in.
         * @param {HTMLElement} summaryEl - The DOM element for the summary.
         */
        function renderTasks(tasks, listEl, summaryEl) {
            listEl.innerHTML = ''; // Clear existing tasks
            
            const totalTasksForDate = getTasksForDate(selectedDate).length; // Total count before filtering

            if (tasks.length === 0 && totalTasksForDate === 0) {
                listEl.innerHTML = `
                    <div class="p-6 text-center text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                        No tasks recorded for ${selectedDate}. Add one below!
                    </div>
                `;
                summaryEl.textContent = '0 Activities Recorded';
                return;
            } else if (tasks.length === 0 && totalTasksForDate > 0) {
                 listEl.innerHTML = `
                    <div class="p-6 text-center text-gray-500 bg-yellow-50 rounded-lg border border-yellow-300">
                        <p class="font-semibold text-lg text-yellow-700">No matching tasks found.</p>
                        <p class="text-sm mt-1">Try resetting your filters above.</p>
                    </div>
                `;
            }

            const total = totalTasksForDate;
            summaryEl.innerHTML = `<span class="font-bold text-indigo-700">${total} Activities Recorded</span>`;

            // Sort tasks by creation time, newest first for display
            tasks.sort((a, b) => b.createdAt - a.createdAt);

            tasks.forEach(task => {
                const listItem = document.createElement('div');
                
                listItem.className = 'flex items-start p-4 mb-2 rounded-xl shadow-sm border bg-white border-gray-200 transition duration-150 ease-in-out';
                listItem.innerHTML = `
                    <div class="flex-grow min-w-0">
                        <p class="text-xs font-semibold text-indigo-600 uppercase tracking-wider mb-1">${task.source}</p>
                        <p class="text-sm text-gray-800 break-words">${task.description}</p>
                    </div>
                    <button class="ml-4 flex-shrink-0 p-2 text-gray-400 hover:text-red-500 transition duration-150 rounded-full" data-task-id="${task.id}" data-action="delete" title="Delete Task">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
                listEl.appendChild(listItem);
            });

            listEl.querySelectorAll('button[data-action="delete"]').forEach(button => {
                button.addEventListener('click', (e) => deleteTask(e.currentTarget.dataset.taskId));
            });
        }

        /**
         * Adds a new task to the selected date's report in the local map and saves to storage.
         */
        function addTask() {
            const descriptionEl = document.getElementById('task-description');
            const sourceSelectEl = document.getElementById('task-source');
            const customSourceInputEl = document.getElementById('custom-source-name');

            const description = descriptionEl.value.trim();
            let source = sourceSelectEl.value;

            if (!description) {
                alertUser('Activity description cannot be empty.');
                return;
            }
            
            if (source === 'Other') {
                const customSource = customSourceInputEl.value.trim();
                if (!customSource) {
                    alertUser('Please enter a custom source name when selecting "Other".');
                    return;
                }
                source = customSource;
            }

            const newTask = {
                id: crypto.randomUUID(),
                source: source,
                description: description,
                createdAt: Date.now()
            };

            const currentTasks = getTasksForDate(selectedDate);
            const updatedTasks = [...currentTasks, newTask];

            allReports[selectedDate] = updatedTasks;
            saveReportsToStorage();
            
            refreshTaskList();

            descriptionEl.value = '';
            sourceSelectEl.value = taskSources[0];
            customSourceInputEl.value = '';
            document.getElementById('custom-source-input-container').classList.add('hidden');
        }

        /**
         * Deletes a task from the report and saves to storage.
         * @param {string} taskId 
         */
        function deleteTask(taskId) {
            // Using a custom modal is preferred over confirm, but for simplicity, using standard confirm
            if (!window.confirm(`Are you sure you want to delete this activity?`)) return; 

            const currentTasks = getTasksForDate(selectedDate);
            const updatedTasks = currentTasks.filter(task => task.id !== taskId);

            if (updatedTasks.length === 0) {
                 delete allReports[selectedDate];
            } else {
                allReports[selectedDate] = updatedTasks;
            }
            
            saveReportsToStorage();
            refreshTaskList();
        }

        /**
         * Custom alert implementation to avoid window.alert/confirm
         * @param {string} message 
         * @param {boolean} isSuccess - If true, displays a success message (green).
         */
        function alertUser(message, isSuccess = false) {
            const alertBox = document.getElementById('custom-alert');
            alertBox.textContent = message;
            
            // Change styling based on success or error
            if (isSuccess) {
                alertBox.classList.remove('bg-red-600');
                alertBox.classList.add('bg-green-600');
            } else {
                alertBox.classList.remove('bg-green-600');
                alertBox.classList.add('bg-red-600');
            }

            alertBox.classList.remove('hidden', 'opacity-0');
            alertBox.classList.add('opacity-100');
            setTimeout(() => {
                alertBox.classList.remove('opacity-100');
                alertBox.classList.add('opacity-0');
                setTimeout(() => alertBox.classList.add('hidden'), 500);
            }, 3000);
        }

        /**
         * Formats the daily report content into a clean, multi-line string for text copying only.
         * @param {Array<Object>} tasks - The tasks to include in the report.
         * @param {string} formattedDate - The localized date string.
         * @returns {string} The formatted report text.
         */
        function formatCleanReportText(tasks, formattedDate) {
            if (tasks.length === 0) {
                return `Daily Activity Report for ${formattedDate}:\n\nNo activities were recorded for this day.`;
            }

            // Sort tasks by creation time, oldest first for chronological report
            tasks.sort((a, b) => a.createdAt - b.createdAt);
            
            let reportText = `[GENERATED BY ${APP_NAME}]\n`;
            reportText += `Daily Activity Report for ${formattedDate}\n`;
            reportText += `Total Activities: ${tasks.length}\n`;
            reportText += `--------------------------------------------------\n\n`;

            tasks.forEach((task, index) => {
                reportText += `${index + 1}. [${task.source}] ${task.description}\n`;
            });

            reportText += `\n--------------------------------------------------\n`;
            reportText += `Generated for: ${USER_NAME}`;
            
            return reportText;
        }


        /**
         * Generates the professionally styled HTML for the report preview/print.
         */
        function generateStyledHtmlReport(tasks, formattedDate) {
            if (tasks.length === 0) {
                 return `
                    <div class="text-center p-8 bg-yellow-50 rounded-xl border border-yellow-300">
                        <p class="font-semibold text-xl text-yellow-700">No Activities Found</p>
                        <p class="mt-2 text-md">There are no recorded activities for ${formattedDate}.</p>
                    </div>
                `;
            }

            // Sort tasks by creation time, oldest first for chronological report
            tasks.sort((a, b) => a.createdAt - b.createdAt);

            // Generate task list HTML (Using more pronounced styling for the report)
            const taskListHtml = tasks.map((task, index) => `
                <li class="report-item flex items-start p-4 rounded-lg border border-gray-100 bg-white shadow-sm transition duration-150 ease-in-out">
                    <span class="text-lg font-bold text-indigo-500 mr-4 flex-shrink-0">${index + 1}.</span>
                    <div class="flex-grow min-w-0">
                        <span class="inline-block px-3 py-1 text-xs font-semibold text-indigo-700 bg-indigo-100 rounded-full mb-1">${task.source}</span>
                        <p class="text-base text-gray-800 break-words mt-0.5">${task.description}</p>
                    </div>
                </li>
            `).join('');

            return `
                <!-- Report Header with Branding (looks like a formal document header) -->
                <header class="report-header p-6 bg-indigo-600 text-white rounded-t-xl mb-6 shadow-lg flex justify-between items-start print-hide">
                    <div>
                        <h1 class="text-3xl font-extrabold">${APP_NAME}</h1>
                        <p class="text-sm font-light opacity-80 mt-1">Professional Daily Activity Log</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold">${formattedDate}</p>
                        <p class="text-sm">Activities: ${tasks.length}</p>
                    </div>
                </header>

                <!-- Print-Only Header (simple and clean for paper) -->
                <div class="hidden print:block print:mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Daily Activity Report: <span class="text-indigo-600">${formattedDate}</span></h1>
                    <p class="text-sm text-gray-600 mt-1">Generated by ${APP_NAME} for ${USER_NAME}. Total Activities: ${tasks.length}</p>
                    <hr class="mt-3 border-gray-300">
                </div>

                <!-- Activity List Section -->
                <section class="report-section p-4 sm:p-6 bg-gray-50 rounded-xl shadow-inner border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Activity Breakdown</h2>
                    <ul class="space-y-4 list-none p-0">
                        ${taskListHtml}
                    </ul>
                </section>
                
                <!-- Report Footer with Formal Branding -->
                <footer class="report-section mt-6 pt-4 border-t border-gray-200 text-center text-sm text-gray-600">
                    <p class="font-medium text-gray-700">Report Generated by ${APP_NAME}</p>
                    <p class="text-xs mt-1">Recipient: This log was created by ${USER_NAME} on ${new Date().toLocaleDateString()}.</p>
                </footer>
            `;
        }


        /**
         * Generates and displays the daily report in a modal.
         */
        function generateDailyReport() {
            const tasks = getTasksForDate(selectedDate);
            const reportContentEl = document.getElementById('report-content');
            const modalEl = document.getElementById('report-modal');

            const formattedDate = new Date(selectedDate + 'T00:00:00').toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // 1. Generate the styled HTML for the visual preview
            const reportHtml = generateStyledHtmlReport([...tasks], formattedDate); // Use copy of tasks for sorting
            reportContentEl.innerHTML = reportHtml;

            // 2. Generate the clean text for fallback (Copy Raw Text)
            currentReportText = formatCleanReportText([...tasks], formattedDate); // Use copy of tasks for sorting
            currentReportSubject = `Daily Activity Report - ${selectedDate}`;

            // 3. Update mailto link and copy button data
            const mailtoLink = document.getElementById('report-mailto-link');
            const copyButton = document.getElementById('copy-report-btn');

            // Set the mailto link properties
            mailtoLink.href = `mailto:?subject=${encodeURIComponent(currentReportSubject)}&body=${encodeURIComponent(currentReportText)}`;
            
            // Set data attribute for clipboard function
            copyButton.setAttribute('data-report-text', currentReportText);
            
            // 4. Show the modal
            modalEl.classList.remove('hidden');
        }

        /**
         * Copies the raw report text from the button's data attribute to the clipboard.
         */
        function copyReportToClipboard() {
            const reportText = document.getElementById('copy-report-btn').getAttribute('data-report-text');

            if (!reportText) {
                alertUser("Error: No report content to copy. Generate the report first.");
                return;
            }

            try {
                // Create a temporary textarea element to hold the text
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = reportText;
                tempTextArea.style.position = 'absolute';
                tempTextArea.style.left = '-9999px'; // Move off-screen
                document.body.appendChild(tempTextArea);

                // Select the content
                tempTextArea.select();
                
                // Execute copy command (works reliably in iFrames)
                document.execCommand('copy');
                
                // Clean up
                document.body.removeChild(tempTextArea);
                
                alertUser('Raw Report Text successfully copied to clipboard!', true);
            } catch (err) {
                console.error('Failed to copy text: ', err);
                alertUser('Failed to copy report. Please copy the text manually from the output area.');
            }
        }


        /**
         * Sets up all necessary event listeners for the UI.
         */
        function setupEventListeners() {
            // Populate Source Dropdowns (Add Task and Filter)
            const addTaskSourceEl = document.getElementById('task-source');
            const filterSourceEl = document.getElementById('filter-source');

            // 1. Add 'All Sources' option to the filter dropdown
            const allOption = document.createElement('option');
            allOption.value = "";
            allOption.textContent = "All Sources";
            filterSourceEl.appendChild(allOption);

            // 2. Populate both dropdowns
            taskSources.forEach(source => {
                const optionAdd = document.createElement('option');
                optionAdd.value = source;
                optionAdd.textContent = source;
                addTaskSourceEl.appendChild(optionAdd);
                
                const optionFilter = document.createElement('option');
                optionFilter.value = source;
                optionFilter.textContent = source;
                filterSourceEl.appendChild(optionFilter);
            });
            
            // Handle Custom Source Input Visibility
            addTaskSourceEl.addEventListener('change', (e) => {
                const customInputContainer = document.getElementById('custom-source-input-container');
                if (e.target.value === 'Other') {
                    customInputContainer.classList.remove('hidden');
                    document.getElementById('custom-source-name').focus();
                } else {
                    customInputContainer.classList.add('hidden');
                }
            });


            // Date Picker Change Handler
            const dateInput = document.getElementById('report-date-picker');
            dateInput.value = selectedDate;
            dateInput.addEventListener('change', (e) => {
                const newDate = e.target.value;
                document.getElementById('current-date-display').textContent = new Date(newDate + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                selectedDate = newDate;
                refreshTaskList();
            });
            
            // Set initial date display
            document.getElementById('current-date-display').textContent = new Date(selectedDate + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });


            // Add Task Button Handler
            document.getElementById('add-task-btn').addEventListener('click', addTask);
            
            // Filter Button Handler
            document.getElementById('apply-filter-btn').addEventListener('click', refreshTaskList);
            
            // Allow pressing 'Enter' key in the search box to trigger filtering
            document.getElementById('search-text').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    refreshTaskList();
                }
            });

            // Report Button Handlers
            document.getElementById('generate-report-btn').addEventListener('click', generateDailyReport);
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                document.getElementById('report-modal').classList.add('hidden');
            });
            document.getElementById('report-modal').addEventListener('click', (e) => {
                if (e.target.id === 'report-modal') {
                    document.getElementById('report-modal').classList.add('hidden');
                }
            });

            // Copy Report Button Handler
            document.getElementById('copy-report-btn').addEventListener('click', copyReportToClipboard);
            
            // Print Button Handler
            document.getElementById('print-report-btn').addEventListener('click', () => window.print());

            // NEW: Logout Button Handler
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
        }

        // Initialize the app on window load
        window.onload = initializeApp;
    </script>
</head>
<body>

    <!-- Custom Alert Box -->
    <div id="custom-alert" class="hidden fixed bottom-5 right-5 z-50 p-4 bg-red-600 text-white rounded-lg shadow-xl transition-opacity duration-500 text-sm opacity-0">
        <!-- Message here -->
    </div>

    <!-- Loading State -->
    <div id="loading-message" class="text-center p-10 mt-20 text-lg font-semibold text-indigo-700">
        Initializing local app...
    </div>

    <!-- Main Application Container -->
    <div id="app-container" class="hidden min-h-screen p-4 sm:p-8">
        <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl p-6 sm:p-10">
            
            <!-- Header -->
            <header class="mb-8 border-b pb-4 relative">
                <div class="flex justify-between items-start">
                    <!-- Title Section -->
                    <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                        Saurav Daily Report
                    </h1>
                    
                    <!-- LOGOUT BUTTON -->
                    <button id="logout-btn" 
                            class="px-3 py-1.5 bg-red-500 text-white font-semibold rounded-full shadow-md hover:bg-red-600 transition duration-150 text-sm flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        Logout
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-1">Saves your daily activities directly in your browser.</p>
            </header>

            <!-- 1. Date Selector and Summary -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8 items-center bg-indigo-50 p-4 rounded-xl shadow-inner border border-indigo-200">
                <div class="sm:col-span-2">
                    <label for="report-date-picker" class="block text-xs font-medium text-indigo-700 uppercase">Viewing Report for</label>
                    <p id="current-date-display" class="text-xl font-bold text-indigo-900 mt-1"></p>
                </div>
                
                <!-- Date Picker -->
                <div class="flex flex-col">
                    <label for="report-date-picker" class="text-xs font-medium text-indigo-700 uppercase mb-1">Change Date</label>
                    <input type="date" id="report-date-picker" 
                           class="w-full px-4 py-2 border border-indigo-400 rounded-lg shadow-md text-gray-800 bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 appearance-none">
                </div>
            </div>
            
            <!-- Summary Display and Generate Report Button -->
            <div class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="p-3 bg-gray-100 rounded-lg text-sm text-gray-700 flex-grow w-full sm:w-auto text-center sm:text-left">
                    Summary: <span id="summary-display" class="ml-2 font-medium text-gray-600">No data loaded.</span>
                </div>
                <!-- Report Button -->
                <button id="generate-report-btn" 
                        class="w-full sm:w-auto px-4 py-2 bg-purple-600 text-white font-semibold rounded-full shadow-md hover:bg-purple-700 transition duration-150 transform hover:scale-105 flex items-center justify-center text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Generate Daily Report
                </button>
            </div>

            <!-- 2. Task Input Form -->
            <section class="mb-10 p-6 bg-gray-50 rounded-2xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Add New Activity</h2>
                <div class="space-y-4">
                    <!-- Source Dropdown -->
                    <div>
                        <label for="task-source" class="block text-sm font-medium text-gray-700 mb-1">Source / Category</label>
                        <select id="task-source" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    
                    <!-- Custom Source Input (Hidden by default) -->
                    <div id="custom-source-input-container" class="hidden">
                        <label for="custom-source-name" class="block text-sm font-medium text-gray-600 mb-1">Enter Custom Source Name</label>
                        <input type="text" id="custom-source-name" placeholder="E.g., Client XYZ Chat"
                               class="w-full p-3 border border-indigo-400 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm bg-white">
                    </div>
                    
                    <!-- Description Input -->
                    <div>
                        <label for="task-description" class="block text-sm font-medium text-gray-700 mb-1">Activity Description (What was done?)</label>
                        <input type="text" id="task-description" placeholder="E.g., Sent final Q3 report to management via Outlook"
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                    </div>

                    <div class="flex items-center justify-end pt-2">
                        <!-- Add Button -->
                        <button id="add-task-btn" 
                                class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-full shadow-md hover:bg-indigo-700 transition duration-150 transform hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                            </svg>
                            Add Activity
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- 2.5 Search and Filter Controls -->
            <section class="mb-8 p-6 bg-yellow-50 rounded-2xl shadow-inner border border-yellow-200">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Filter Activities</h2>
                <div class="grid grid-cols-1 sm:grid-cols-5 gap-4">
                    <div class="sm:col-span-2">
                        <label for="filter-source" class="block text-sm font-medium text-gray-700 mb-1">Filter by Source</label>
                        <select id="filter-source" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 shadow-sm">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="search-text" class="block text-sm font-medium text-gray-700 mb-1">Search Description</label>
                        <input type="text" id="search-text" placeholder="Keywords or phrases"
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 shadow-sm">
                    </div>
                    <div class="sm:col-span-1 flex items-end">
                        <button id="apply-filter-btn" 
                                class="w-full px-4 py-3 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600 transition duration-150 transform hover:scale-[1.02]">
                            Filter
                        </button>
                    </div>
                </div>
            </section>

            <!-- 3. Real-Time Task List -->
            <section>
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Daily Activity Log</h2>
                <div id="task-list" class="task-list-container space-y-3 max-h-[500px] overflow-y-auto pr-2">
                    <!-- Tasks will be rendered here by JavaScript -->
                    <p class="text-center text-gray-500 p-6">Loading tasks...</p>
                </div>
            </section>
            
            <!-- Footer/Branding -->
            <footer class="mt-8 pt-4 border-t border-gray-200 text-right text-xs text-gray-500">
                Web application created by <span class="font-bold text-gray-700">SAURAV CHAUHAN</span>
            </footer>

        </div>
    </div>
    
    <!-- Daily Report Modal (Hidden by default) -->
    <div id="report-modal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 transition-opacity duration-300 flex justify-center items-center">
        <!-- Enlarged modal structure using max-w-6xl for maximum screen usage -->
        <div id="report-modal-content-wrapper" class="bg-white rounded-xl shadow-2xl w-full max-w-6xl m-4 p-4 sm:p-8 transform transition-all duration-300">
            
            <!-- Modal Header (Controls) -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center pb-4 mb-4 border-b print-hide">
                <h3 class="text-2xl font-bold text-indigo-700">Report Ready to Share</h3>
                
                <div class="flex gap-3 mt-3 sm:mt-0">
                    <!-- Print Button -->
                    <button id="print-report-btn"
                            class="w-full sm:w-auto px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 text-sm flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2z" />
                        </svg>
                        Print / Export as PDF
                    </button>

                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 p-1 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Modal Content Area (The actual report) -->
            <div id="report-content" class="space-y-4 text-gray-700 max-h-[70vh] overflow-y-auto pr-2">
                <!-- Styled Report content will be injected here by JS -->
            </div>

            <!-- Modal Action Buttons for Sharing (Print-Hide) -->
            <div class="mt-6 print-hide">
                <div class="pt-4 border-t border-gray-200 flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3">
                    
                    <!-- Copy Raw Text Button (as a fallback) -->
                    <button id="copy-report-btn" data-report-text=""
                            class="w-full sm:w-auto px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg shadow-md hover:bg-gray-600 transition duration-150 text-sm flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                            <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
                        </svg>
                        Copy Raw Text (Fallback)
                    </button>
                    
                    <!-- Email Link -->
                    <a id="report-mailto-link" href="#" target="_blank"
                       class="w-full sm:w-auto px-4 py-2 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 transition duration-150 text-sm flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-2 4v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" />
                        </svg>
                        Send via Email
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
